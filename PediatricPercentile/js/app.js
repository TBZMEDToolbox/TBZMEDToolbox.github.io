

function getZPercent(z) 
  {
    //z == number of standard deviations from the mean
    //if z is greater than 6.5 standard deviations from the mean
    //the number of significant digits will be outside of a reasonable 
    //range
    if ( z < -6.5)
      return 0.0;
    if( z > 6.5) 
      return 1.0;

    var factK = 1;
    var sum = 0;
    var term = 1;
    var k = 0;
    var loopStop = Math.exp(-23);
    while(Math.abs(term) > loopStop) 
    {
      term = .3989422804 * Math.pow(-1,k) * Math.pow(z,k) / (2 * k + 1) / Math.pow(2,k) * Math.pow(z,k+1) / factK;
      sum += term;
      k++;
      factK *= k;

    }
    sum += 0.5;

    return sum;
  }
  
  /**  Gregorian & Jalali (Hijri_Shamsi,Solar) Date Converter Functions
Author: JDF.SCR.IR =>> Download Full Version :  http://jdf.scr.ir/jdf
License: GNU/LGPL _ Open Source & Free :: Version: 2.81 : [2020=1399]
---------------------------------------------------------------------
355746=361590-5844 & 361590=(30*33*365)+(30*8) & 5844=(16*365)+(16/4)
355666=355746-79-1 & 355668=355746-79+1 &  1595=605+990 &  605=621-16
990=30*33 & 12053=(365*33)+(32/4) & 36524=(365*100)+(100/4)-(100/100)
1461=(365*4)+(4/4) & 146097=(365*400)+(400/4)-(400/100)+(400/400)  */


function jalali_to_gregorian(jy, jm, jd) {
  var sal_a, gy, gm, gd, days;
  jy += 1595;
  days = -355668 + (365 * jy) + (~~(jy / 33) * 8) + ~~(((jy % 33) + 3) / 4) + jd + ((jm < 7) ? (jm - 1) * 31 : ((jm - 7) * 30) + 186);
  gy = 400 * ~~(days / 146097);
  days %= 146097;
  if (days > 36524) {
    gy += 100 * ~~(--days / 36524);
    days %= 36524;
    if (days >= 365) days++;
  }
  gy += 4 * ~~(days / 1461);
  days %= 1461;
  if (days > 365) {
    gy += ~~((days - 1) / 365);
    days = (days - 1) % 365;
  }
  gd = days + 1;
  sal_a = [0, 31, ((gy % 4 === 0 && gy % 100 !== 0) || (gy % 400 === 0)) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  for (gm = 0; gm < 13 && gd > sal_a[gm]; gm++) gd -= sal_a[gm];
  return [gy, gm, gd];
}



function getLMS(sex, index, parameter){
	// sex 0:Male sex 1:Female
	// parameter 0:Weight 1:Length 2:Head Circumference
	//I could've made this more compact by removing all the "L", "M", and "S" keys by putting the values in arrays as we know that all of them are sorted as L-M-S but I used an online tool to convert the CDC's CSV files to JSON and didn't want to deal with writing the code for the conversion.
	//CDC datasets of up to 36 months with the 36th month itself removed. M: Male F: Female W:Weight L:Length  H:Head Circumference A:Age:
	const MWA36 = [{"L":1.815151075,"M":3.530203168,"S":0.152385273},{"L":1.547523128,"M":4.003106424,"S":0.146025021},{"L":1.068795548,"M":4.879525083,"S":0.136478767},{"L":0.695973505,"M":5.672888765,"S":0.129677511},{"L":0.41981509,"M":6.391391982,"S":0.124717085},{"L":0.219866801,"M":7.041836432,"S":0.121040119},{"L":0.077505598,"M":7.630425182,"S":0.1182712},{"L":-0.02190761,"M":8.162951035,"S":0.116153695},{"L":-0.0894409,"M":8.644832479,"S":0.114510349},{"L":-0.1334091,"M":9.081119817,"S":0.113217163},{"L":-0.1600954,"M":9.476500305,"S":0.11218624},{"L":-0.17429685,"M":9.835307701,"S":0.111354536},{"L":-0.1797189,"M":10.16153567,"S":0.110676413},{"L":-0.179254,"M":10.45885399,"S":0.110118635},{"L":-0.17518447,"M":10.7306256,"S":0.109656941},{"L":-0.16932268,"M":10.97992482,"S":0.109273653},{"L":-0.1631139,"M":11.20955529,"S":0.10895596},{"L":-0.15770999,"M":11.4220677,"S":0.108694678},{"L":-0.15402279,"M":11.61977698,"S":0.108483324},{"L":-0.15276214,"M":11.80477902,"S":0.108317416},{"L":-0.15446658,"M":11.9789663,"S":0.108193944},{"L":-0.15952202,"M":12.14404334,"S":0.108110954},{"L":-0.16817926,"M":12.30154103,"S":0.108067236},{"L":-0.1805668,"M":12.45283028,"S":0.108062078},{"L":-0.19670196,"M":12.59913494,"S":0.108095077},{"L":-0.21650121,"M":12.74154396,"S":0.108166005},{"L":-0.23979048,"M":12.88102276,"S":0.108274705},{"L":-0.26631585,"M":13.01842382,"S":0.108421024},{"L":-0.29575496,"M":13.1544966,"S":0.108604769},{"L":-0.32772936,"M":13.28989667,"S":0.108825681},{"L":-0.36181746,"M":13.42519408,"S":0.109083423},{"L":-0.39756808,"M":13.56088113,"S":0.109377581},{"L":-0.43452025,"M":13.69737858,"S":0.109707646},{"L":-0.47218875,"M":13.83504622,"S":0.110073084},{"L":-0.51012309,"M":13.97418199,"S":0.110473238},{"L":-0.54788557,"M":14.1150324,"S":0.1109074},{"L":-0.5850701,"M":14.25779618,"S":0.111374787}];
	const FWA36 = [{"L":1.509187507,"M":3.39918645,"S":0.142106724},{"L":1.357944315,"M":3.79752846,"S":0.138075916},{"L":1.105537708,"M":4.544776513,"S":0.131733888},{"L":0.902596648,"M":5.230584214,"S":0.126892697},{"L":0.734121414,"M":5.859960798,"S":0.123025182},{"L":0.590235275,"M":6.437587751,"S":0.119840911},{"L":0.464391566,"M":6.967850457,"S":0.117166868},{"L":0.352164071,"M":7.454854109,"S":0.11489384},{"L":0.250497889,"M":7.902436186,"S":0.112949644},{"L":0.15724751,"M":8.314178377,"S":0.11128469},{"L":0.070885725,"M":8.693418423,"S":0.109863709},{"L":-0.00968493,"M":9.043261854,"S":0.10866078},{"L":-0.085258,"M":9.366593571,"S":0.10765621},{"L":-0.15640945,"M":9.666089185,"S":0.106834517},{"L":-0.22355869,"M":9.944226063,"S":0.106183085},{"L":-0.28701346,"M":10.20329397,"S":0.105691242},{"L":-0.34699919,"M":10.4454058,"S":0.105349631},{"L":-0.40368918,"M":10.67250698,"S":0.105149754},{"L":-0.45721877,"M":10.88638558,"S":0.105083666},{"L":-0.50770077,"M":11.08868151,"S":0.105143752},{"L":-0.55523599,"M":11.28089537,"S":0.105322575},{"L":-0.59992113,"M":11.46439708,"S":0.10561278},{"L":-0.64185418,"M":11.64043402,"S":0.106007025},{"L":-0.6811381,"M":11.81013895,"S":0.106497957},{"L":-0.71788283,"M":11.97453748,"S":0.107078197},{"L":-0.75220617,"M":12.13455528,"S":0.107740346},{"L":-0.78423359,"M":12.2910249,"S":0.108477009},{"L":-0.81409743,"M":12.44469237,"S":0.109280822},{"L":-0.8419355,"M":12.59622335,"S":0.110144488},{"L":-0.86788939,"M":12.74620911,"S":0.111060814},{"L":-0.89210264,"M":12.89517218,"S":0.112022758},{"L":-0.91471881,"M":13.04357164,"S":0.113023466},{"L":-0.93587966,"M":13.19180827,"S":0.114056316},{"L":-0.95572344,"M":13.34022934,"S":0.115114952},{"L":-0.97438101,"M":13.48913357,"S":0.116193337},{"L":-0.99198075,"M":13.63877446,"S":0.11728575},{"L":-1.00864074,"M":13.78936547,"S":0.118386847}];
	const MLA36 = [{"L":1.267004226,"M":49.98888408,"S":0.053112191},{"L":0.511237696,"M":52.6959753,"S":0.048692684},{"L":-0.45224446,"M":56.62842855,"S":0.04411683},{"L":-0.990594599,"M":59.60895343,"S":0.041795583},{"L":-1.285837689,"M":62.07700027,"S":0.040454126},{"L":-1.43031238,"M":64.2168641,"S":0.039633879},{"L":-1.47657547,"M":66.1253149,"S":0.039123813},{"L":-1.456837849,"M":67.8601799,"S":0.038811994},{"L":-1.391898768,"M":69.45908458,"S":0.038633209},{"L":-1.29571459,"M":70.94803912,"S":0.038546833},{"L":-1.177919048,"M":72.34586111,"S":0.038526262},{"L":-1.045326049,"M":73.6666541,"S":0.038553387},{"L":-0.902800887,"M":74.92129717,"S":0.038615501},{"L":-0.753908107,"M":76.11837536,"S":0.038703461},{"L":-0.601263523,"M":77.26479911,"S":0.038810557},{"L":-0.446805039,"M":78.36622309,"S":0.038931784},{"L":-0.291974772,"M":79.4273405,"S":0.039063356},{"L":-0.13784767,"M":80.45209492,"S":0.039202382},{"L":0.014776155,"M":81.44383603,"S":0.039346629},{"L":0.165304169,"M":82.40543643,"S":0.039494365},{"L":0.313301809,"M":83.33938063,"S":0.039644238},{"L":0.458455471,"M":84.24783394,"S":0.039795189},{"L":0.600544631,"M":85.13269658,"S":0.039946388},{"L":0.739438953,"M":85.9956488,"S":0.040097181},{"L":0.875000447,"M":86.8381751,"S":0.04024706},{"L":1.00720807,"M":87.66160934,"S":0.040395626},{"L":0.837251351,"M":88.45247282,"S":0.040577525},{"L":0.681492975,"M":89.22326434,"S":0.040723122},{"L":0.538779654,"M":89.97549228,"S":0.040833194},{"L":0.407697153,"M":90.71040853,"S":0.040909059},{"L":0.286762453,"M":91.42907762,"S":0.040952433},{"L":0.174489485,"M":92.13242379,"S":0.04096533},{"L":0.069444521,"M":92.82127167,"S":0.040949976},{"L":-0.029720564,"M":93.49637946,"S":0.040908737},{"L":-0.124251789,"M":94.15846546,"S":0.040844062},{"L":-0.215288396,"M":94.80822923,"S":0.040758431},{"L":-0.30385434,"M":95.44636981,"S":0.040654312}];
	const FLA36 = [{"L":-1.295960857,"M":49.28639612,"S":0.05008556},{"L":-0.809249882,"M":51.68358057,"S":0.046818545},{"L":-0.050782985,"M":55.28612813,"S":0.0434439},{"L":0.476851407,"M":58.09381906,"S":0.041716103},{"L":0.843299612,"M":60.45980763,"S":0.040705173},{"L":1.097562257,"M":62.53669656,"S":0.040079765},{"L":1.272509641,"M":64.40632762,"S":0.039686845},{"L":1.390428859,"M":66.11841553,"S":0.039444555},{"L":1.466733925,"M":67.70574419,"S":0.039304738},{"L":1.512301976,"M":69.19123614,"S":0.03923711},{"L":1.534950767,"M":70.59163924,"S":0.039221665},{"L":1.540390875,"M":71.91961673,"S":0.039244672},{"L":1.532852892,"M":73.1850104,"S":0.03929642},{"L":1.51550947,"M":74.39564379,"S":0.039369875},{"L":1.490765028,"M":75.5578544,"S":0.039459832},{"L":1.460458255,"M":76.67685871,"S":0.039562382},{"L":1.426006009,"M":77.75700986,"S":0.039674542},{"L":1.388507095,"M":78.80198406,"S":0.03979401},{"L":1.348818127,"M":79.81491852,"S":0.039918994},{"L":1.307609654,"M":80.79851532,"S":0.040048084},{"L":1.265408149,"M":81.75512092,"S":0.040180162},{"L":1.222627732,"M":82.6867881,"S":0.04031434},{"L":1.179594365,"M":83.59532461,"S":0.040449904},{"L":1.136564448,"M":84.48233206,"S":0.040586283},{"L":1.093731947,"M":85.34923624,"S":0.040723015},{"L":1.051272912,"M":86.1973169,"S":0.040859727},{"L":1.041951175,"M":87.09026318,"S":0.041142161},{"L":1.012592236,"M":87.95714182,"S":0.041349399},{"L":0.970541909,"M":88.7960184,"S":0.041500428},{"L":0.921129988,"M":89.6055115,"S":0.041610508},{"L":0.868221392,"M":90.38476689,"S":0.041691761},{"L":0.81454413,"M":91.13341722,"S":0.04175368},{"L":0.761957977,"M":91.8515436,"S":0.041803562},{"L":0.711660228,"M":92.5396352,"S":0.041846882},{"L":0.664323379,"M":93.19854429,"S":0.041887626},{"L":0.620285102,"M":93.82945392,"S":0.041928568},{"L":0.57955631,"M":94.43382278,"S":0.041971514}];
	const MHA36 = [{"L":4.427825037,"M":35.81366835,"S":0.052172542},{"L":4.310927464,"M":37.19361054,"S":0.047259148},{"L":3.869576802,"M":39.20742929,"S":0.040947903},{"L":3.305593039,"M":40.65233195,"S":0.037027722},{"L":2.720590297,"M":41.76516959,"S":0.034364245},{"L":2.16804824,"M":42.66116148,"S":0.032462175},{"L":1.675465689,"M":43.40488731,"S":0.031064702},{"L":1.255160322,"M":44.03609923,"S":0.03002267},{"L":0.91054114,"M":44.58096912,"S":0.029242173},{"L":0.639510474,"M":45.05761215,"S":0.028660454},{"L":0.436978864,"M":45.4790756,"S":0.0282336},{"L":0.296275856,"M":45.85505706,"S":0.027929764},{"L":0.210107251,"M":46.19295427,"S":0.027725179},{"L":0.171147024,"M":46.49853438,"S":0.027601686},{"L":0.172393886,"M":46.77637684,"S":0.027545148},{"L":0.207371541,"M":47.03017599,"S":0.027544382},{"L":0.270226126,"M":47.2629533,"S":0.027590417},{"L":0.355757274,"M":47.47720989,"S":0.02767598},{"L":0.459407627,"M":47.67503833,"S":0.027795115},{"L":0.577227615,"M":47.85820606,"S":0.0279429},{"L":0.705826778,"M":48.02821867,"S":0.028115241},{"L":0.842319055,"M":48.18636864,"S":0.028308707},{"L":0.984266833,"M":48.3337732,"S":0.028520407},{"L":1.129626698,"M":48.47140432,"S":0.028747896},{"L":1.276691223,"M":48.60011223,"S":0.028989089},{"L":1.424084853,"M":48.72064621,"S":0.029242207},{"L":1.570621291,"M":48.83366629,"S":0.029505723},{"L":1.715393998,"M":48.93976089,"S":0.029778323},{"L":1.857652984,"M":49.03945383,"S":0.030058871},{"L":1.996810563,"M":49.13321432,"S":0.030346384},{"L":2.132411346,"M":49.22146409,"S":0.030640006},{"L":2.264111009,"M":49.30458348,"S":0.030938992},{"L":2.391658052,"M":49.38291658,"S":0.031242693},{"L":2.514878222,"M":49.45677569,"S":0.031550537},{"L":2.633661226,"M":49.526445,"S":0.031862026},{"L":2.747949445,"M":49.59218385,"S":0.03217672},{"L":2.857728375,"M":49.65422952,"S":0.032494231}];
	const FHA36 = [{"L":-1.298749689,"M":34.7115617,"S":0.046905108},{"L":-1.440271514,"M":36.03453876,"S":0.042999604},{"L":-1.581016348,"M":37.97671987,"S":0.038067862},{"L":-1.593136386,"M":39.3801263,"S":0.035079612},{"L":-1.521492427,"M":40.46773733,"S":0.033096443},{"L":-1.394565915,"M":41.34841008,"S":0.03170963},{"L":-1.231713389,"M":42.0833507,"S":0.030709039},{"L":-1.046582628,"M":42.71033603,"S":0.029974303},{"L":-0.848932692,"M":43.25428882,"S":0.029430992},{"L":-0.645779124,"M":43.73249646,"S":0.029030379},{"L":-0.442165412,"M":44.15742837,"S":0.028739112},{"L":-0.24163206,"M":44.53836794,"S":0.028533537},{"L":-0.046673786,"M":44.88240562,"S":0.028396382},{"L":0.141031094,"M":45.19507651,"S":0.028314722},{"L":0.320403169,"M":45.48078147,"S":0.028278682},{"L":0.490807133,"M":45.74307527,"S":0.028280585},{"L":0.65193505,"M":45.98486901,"S":0.028314363},{"L":0.803718086,"M":46.20857558,"S":0.028375159},{"L":0.946259679,"M":46.41621635,"S":0.028459033},{"L":1.079784984,"M":46.60950084,"S":0.028562759},{"L":1.204602687,"M":46.78988722,"S":0.028683666},{"L":1.321076285,"M":46.95862881,"S":0.028819525},{"L":1.429602576,"M":47.11681039,"S":0.028968459},{"L":1.530595677,"M":47.26537682,"S":0.029128879},{"L":1.624475262,"M":47.40515585,"S":0.029299426},{"L":1.71165803,"M":47.53687649,"S":0.029478937},{"L":1.792551616,"M":47.66118396,"S":0.029666406},{"L":1.867550375,"M":47.77865186,"S":0.02986096},{"L":1.93703258,"M":47.8897923,"S":0.030061839},{"L":2.001358669,"M":47.99506422,"S":0.030268375},{"L":2.060870301,"M":48.09488048,"S":0.030479985},{"L":2.115889982,"M":48.18961365,"S":0.03069615},{"L":2.16672113,"M":48.2796011,"S":0.030916413},{"L":2.21364844,"M":48.36514917,"S":0.031140368},{"L":2.256943216,"M":48.44653703,"S":0.031367651},{"L":2.296844024,"M":48.52401894,"S":0.031597939},{"L":2.333589434,"M":48.59782828,"S":0.031830942}];
	
	let targetLMS = {};
	if (sex == 0) {
		if (parameter == 0){
		    targetLMS = Object.assign({}, MWA36[index]);
		}
		else if (parameter == 1){
			targetLMS = Object.assign({}, MLA36[index]);
		}
		else if (parameter == 2){
			targetLMS = Object.assign({}, MHA36[index]);
		}
		
		else {
			throw "Not Implemented"
		}
	}
	
	else if (sex == 1) {
		
		if (parameter == 0){
		    targetLMS = Object.assign({}, FWA36[index]);
		}
		else if (parameter == 1){
			targetLMS = Object.assign({}, FLA36[index]);
		}
		else if (parameter == 2){
			targetLMS = Object.assign({}, FHA36[index]);
		}
		else {
			throw "Not Implemented"
		}
	}
	
	else {
		throw "Not Implemented"
	}
	
    let L = targetLMS["L"];
    let M = targetLMS["M"];
    let S = targetLMS["S"];
    console.log(L, M, S);
	
	return [L, M, S];
}


function getZScore(sex, index, parameter, amount){
	
	
	let LMS = getLMS(sex, index, parameter);
	let L = LMS[0];
	let M = LMS[1];
	let S = LMS[2];
	let Z = (((amount/M) ** L)-1)/(L*S);
	console.log(Z);
	return(Z);
}


function getAgeMonths(birthDate){
	return(
	(Date.now() - birthDate.getTime())/ (1000 * 3600 * 24 * 30));
	}
	
	
function getPercentile(sex, index, parameter, amount){
	
	return(getZPercent(getZScore(sex, index, parameter, amount)));
	}










function parseUserInput(){
//convert Age or Recieve month directly
//Check for bad input bad dates, strings instead of numbers, bad weights, bad ages

	

let bday = document.getElementById("bday").value;
let weight = document.getElementById("weight").value;
let height = document.getElementById("height").value;
let headc = document.getElementById("height").value;
var sex = document.getElementById("sex").value;
let submitOK = true;
console.log(bday);

if (bday == null) {
  alert("Invalid Birthday 1");
  submitOK = false;
}
else{

	let splitDate = bday.split("/");
	console.log(splitDate);
	
	if (splitDate.length != 3){
	alert("Invalid Birthday 2");
	  submitOK = false;
 	 }
	else {
	    
	    
		var gregorianDate = jalali_to_gregorian(parseInt(splitDate[0]), parseInt(splitDate[1]), parseInt(splitDate[2]));
		let birthDate = new Date(gregorianDate[0]+"-"+gregorianDate[1]+"-"+gregorianDate[2]);
		var ageMonths = Math.floor(getAgeMonths(birthDate));
		let index = ageMonths+1;
		
		if (isNaN(ageMonths) || ageMonths < 0 || ageMonths > 36) {
		alert("Age is beyond the expected range");
		submitOK = false;
			}
				
		}
		
	}


/*if (!(index > -2 && index < 241)){
	throw 'سن بالاتر از 20 سال';
	return;}
	INDEX SHOUD INCLUDE AT BIRTH
	*/



if (submitOK == false) {
  return false;
	} 
}


//console.log(Math.floor((getPercentile(sex, ageMonths, /*parameter*/, /*amount*/))*100));
